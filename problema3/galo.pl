% cada posicao pode ter "x", "o" ou "v" (vazio)
estado_inicial([[x,v,v,v,v],[o,o,v,v,v],[x,o,x,v,v],[o,x,x,o,v]]).
%estado_inicial([[v,v,v],[v,v,v],[v,v,v]]).

terminal(G) :- linhas(G,_).
terminal(G) :- colunas(G,_).
terminal(G) :- diagonal(G,_).
terminal(G) :- cheio(G).

linhas([[X,X,X,_,_],_,_,_],X) :- X \= v.
linhas([[_,X,X,X,_],_,_,_],X) :- X \= v.
linhas([[_,_,X,X,X],_,_,_],X) :- X \= v.

linhas([_,[X,X,X,_,_],_,_],X) :- X \= v.
linhas([_,[_,X,X,X,_],_,_],X) :- X \= v.
linhas([_,[_,_,X,X,X],_,_],X) :- X \= v.

linhas([_,_,[X,X,X,_,_],_],X) :- X \= v.
linhas([_,_,[_,X,X,X,_],_],X) :- X \= v.
linhas([_,_,[_,_,X,X,X],_],X) :- X \= v.

linhas([_,_,_,[X,X,X,_,_]],X) :- X \= v.
linhas([_,_,_,[_,X,X,X,_]],X) :- X \= v.
linhas([_,_,_,[_,_,X,X,X]],X) :- X \= v.

colunas([[X,_,_,_,_],[X,_,_,_,_],[X,_,_,_,_], [_,_,_,_,_]],X) :- X \= v.
colunas([[_,_,_,_,_],[X,_,_,_,_],[X,_,_,_,_], [X,_,_,_,_]],X) :- X \= v.

colunas([[_,X,_,_,_],[_,X,_,_,_],[_,X,_,_,_], [_,_,_,_,_]],X) :- X \= v.
colunas([[_,_,_,_,_],[_,X,_,_,_],[_,X,_,_,_], [_,X,_,_,_]],X) :- X \= v.

colunas([[_,_,X,_,_],[_,_,X,_,_],[_,_,X,_,_], [_,_,_,_,_]],X) :- X \= v.
colunas([[_,_,_,_,_],[_,_,X,_,_],[_,_,X,_,_], [_,_,X,_,_]],X) :- X \= v.

colunas([[_,_,_,X,_],[_,_,_,X,_],[_,_,_,X,_], [_,_,_,_,_]],X) :- X \= v.
colunas([[_,_,_,_,_],[_,_,_,X,_],[_,_,_,X,_], [_,_,_,X,_]],X) :- X \= v.

colunas([[_,_,_,_,X],[_,_,_,_,X],[_,_,_,_,X], [_,_,_,_,_]],X) :- X \= v.
colunas([[_,_,_,_,_],[_,_,_,_,X],[_,_,_,_,X], [_,_,_,_,X]],X) :- X \= v.


diagonal([[X,_,_,_,_],[_,X,_,_,_],[_,_,X,_,_], [_,_,_,_,_]],X) :- X \= v.
diagonal([[_,_,_,_,_],[_,X,_,_,_],[_,_,X,_,_], [_,_,_,X,_]],X) :- X \= v.
diagonal([[_,_,_,_,_],[X,_,_,_,_],[_,X,_,_,_], [_,_,X,_,_]],X) :- X \= v.
diagonal([[_,X,_,_,_],[_,_,X,_,_],[_,_,_,X,_], [_,_,_,_,_]],X) :- X \= v.
diagonal([[_,_,_,_,_],[_,_,X,_,_],[_,_,_,X,_], [_,_,_,_,X]],X) :- X \= v.
diagonal([[_,_,X,_,_],[_,_,_,X,_],[_,_,_,_,X], [_,_,_,_,_]],X) :- X \= v.

diagonal([[_,_,X,_,_],[_,X,_,_,_],[X,_,_,_,_], [_,_,_,_,_]],X) :- X \= v.
diagonal([[_,_,_,_,_],[_,_,X,_,_],[_,X,_,_,_], [X,_,_,_,_]],X) :- X \= v.
diagonal([[_,_,_,X,_],[_,_,X,_,_],[_,X,_,_,_], [_,_,_,_,_]],X) :- X \= v.
diagonal([[_,_,_,_,X],[_,_,_,X,_],[_,_,X,_,_], [_,_,_,_,_]],X) :- X \= v.
diagonal([[_,_,_,_,_],[_,_,_,X,_],[_,_,X,_,_], [_,X,_,_,_]],X) :- X \= v.
diagonal([[_,_,_,_,_],[_,_,_,_,X],[_,_,_,X,_], [_,_,X,_,_]],X) :- X \= v.

cheio([L1,L2,L3,L4]) :-
    append(L1,L2, L12),
    append(L12, L3, L123),
    append(L123, L4, L1234)
    \+ member(v, L1234).

%função de utilidade, retorna o valor dos estados terminais, 1 ganha -1 perde
valor(G, 1) :- linhas(G,x).
valor(G, 1) :- colunas(G,x).
valor(G, 1) :- diagonal(G,x).
valor(G, -1) :- linhas(G,o).
valor(G, -1) :- colunas(G,o).
valor(G, -1) :- diagonal(G,o).
valor(_, 0).

% oper(estado,jogador,jogada,estado seguinte)
oper(E, J,joga(X,Y), En) :-
	joga_vazio(E,J,X, Y, En).


joga_vazio([[v, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]],
            J,
            1,1,
            [[J, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]]):- C21 \= v, C31 \= v, C41 \= v.

joga_vazio([[C11, C12, C13, C14, C15],
            [v, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]],
            J,
            2,1,
            [[C11, C12, C13, C14, C15],
            [J, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]]):-  C31 \= v, C41 \= v.

joga_vazio([[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [v, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]],
            J,
            3,1,
            [[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [J, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]]):-  C41 \= v.

joga_vazio([[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [v, C42, C43, C44, C45]],
            J,
            4,1,
            [[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [J, C42, C43, C44, C45]]).

joga_vazio([[C11, v, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]],
            J,
            1,2,
            [[C11, J, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]]):- C22 \= v, C32 \= v, C42 \= v.

joga_vazio([[C11, C12, C13, C14, C15],
            [C21, v, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]],
            J,
            2,2,
            [[C11, C12, C13, C14, C15],
            [C21, J, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]]):-  C32 \= v, C42 \= v.

joga_vazio([[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, v, C33, C34, C35],
            [C41, C42, C43, C44, C45]],
            J,
            3,2,
            [[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, J, C33, C34, C35],
            [C41, C42, C43, C44, C45]]):-  C42 \= v.

joga_vazio([[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, v, C43, C44, C45]],
            J,
            4,2,
            [[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, J, C43, C44, C45]]).

joga_vazio([[C11, C12, v, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]],
            J,
            1,3,
            [[C11, C22, CJ, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]]):- C23 \= v, C33 \= v, C43 \= v.

joga_vazio([[C11, C12, C13, C14, C15],
            [C21, C22, v, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]],
            J,
            2,3,
            [[C11, C12, C13, C14, C15],
            [C21, C22, J, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]]):-  C33 \= v, C43 \= v.

joga_vazio([[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31,C32, v, C34, C35],
            [C41, C42, C43, C44, C45]],
            J,
            3,3,
            [[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, J, C34, C35],
            [C41, C42, C43, C44, C45]]):-  C43 \= v.

joga_vazio([[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, vC42, v, C44, C45]],
            J,
            4,3,
            [[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, J, C44, C45]]).

joga_vazio([[C11, C12, C13, v, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]],
            J,
            1,4,
            [[C11, C12, C13, J, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]]):- C24 \= v, C34 \= v, C44 \= v.

joga_vazio([[C11, C12, C13, C14, C15],
            [C21, C22, C23, v, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]],
            J,
            2,4,
            [[C11, C12, C13, C14, C15],
            [C21, C22, C23, J, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]]):-  C34 \= v, C44 \= v.

joga_vazio([[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, v, C35],
            [C41, C42, C43, C44, C45]],
            J,
            3,4,
            [[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, J, C35],
            [C41, C42, C43, C44, C45]]):-  C44 \= v.

joga_vazio([[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, v, C45]],
            J,
            4,4,
            [[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, J, C45]]).

joga_vazio([[C11, C12, C13, C14, v],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]],
            J,
            1,5,
            [[C11, C12, C13, C14, J],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]]):- C25 \= v, C35 \= v, C45 \= v.

joga_vazio([[C11, C12, C13, C14, C15],
            [C21, C32, C23, C24, v],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]],
            J,
            2,5,
            [[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, J],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, C45]]):-  C35 \= v, C45 \= v.

joga_vazio([[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, v],
            [C41, C42, C43, C44, C45]],
            J,
            3,5,
            [[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, J],
            [C41, C42, C43, C44, C45]]):-  C45 \= v.

joga_vazio([[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, v]],
            J,
            4,5,
            [[C11, C12, C13, C14, C15],
            [C21, C22, C23, C24, C25],
            [C31, C32, C33, C34, C35],
            [C41, C42, C43, C44, J]]).
